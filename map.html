<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
    <title>Daum 지도 시작하기</title>
    <style>
        
        .map_wrap {
            position:relative;
            width:100%;
            height:350px;
        }
        .address_wrap {
            position:  absolute;
            left:10px;
            top:10px;
            border-radius: 2px;
            background:rgba(255,255,255,0.8);
            z-index:1;
            padding:5px;
        }
        #address {
            display:block;
            margin-top:2px;
            font-weight: normal;
        }
        .map{
            width: 500px;
            height: 400px;
        }
        
    </style>
</head>
<body>
    <!-- ////////////////////////////////  지도 표시할 레이아웃  //////////////////////////////////////// -->
    <div class="map_wrap">
        <!-- 지도가 들어갈 div -->
        <div class="map"></div>
        <div class="address_wrap">
            <!-- 주소가 들어갈 div -->
            <span id="address"></span>
        </div>
    </div>
    <!-- /////////////////////////////////////////////////////////////////////////////////////////// -->
    

    <!-- 지도 키 값 받아오기 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=922b804a1e5a9b89656db406da17e07d&libraries=services"></script>
    

	<script>

    // ---------------------------------- 지도만들기  --------------------------------------------
		var container = document.getElementsByClassName('map');
		var options = {
            // 위도와 경도를 입력하여 지도의 시작위치 표시, 카카오 본사
            center: new daum.maps.LatLng(33.450701, 126.570667),
            // 지도의 확대 정도, 자연수 값
			level: 3
		};
        // container와 options를 넘겨주어 지도 생성
        var map = new daum.maps.Map(container[0], options);
    // ------------------------------------------------------------------------------------------


    // ---------------------------------- 목적지 마커 생성  --------------------------------------------
        // 맵 중앙의 좌표를 받아와서 마커 생성
        var marker = new daum.maps.Marker({
            position: map.getCenter()
        });
    
        // 지도에 마커 표시
        marker.setMap(map);
    // ------------------------------------------------------------------------------------------

    // ---------------------------------- 참가자 마커 생성  --------------------------------------------
    // 마커를 표시할 위치와 title 객체 배열입니다 
        var positions = [
            {
                title: '카카오', 
                latlng: new daum.maps.LatLng(33.450705, 126.570677)
            },
            {
                title: '생태연못', 
                latlng: new daum.maps.LatLng(33.450936, 126.569477)
            },
            {
                title: '텃밭', 
                latlng: new daum.maps.LatLng(33.450879, 126.569940)
            },
            {
                title: '근린공원',
                latlng: new daum.maps.LatLng(33.451393, 126.570738)
            }
        ];
        // 이미지 링크, 여기 링크를 우리 사진으로 넣어주면 된다.
        // image 배열을 만들고 url을 담아서 리스트 인덱스로 넘겨주자.
        var image_src = "http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 
        
        // 마커 위치 객체의 수만큼 반복
        for (var i=0;i<positions.length;i++){
            // 이미지의 크기 결정
            var image_size = new daum.maps.Size(24,35);
            // 이미지 생성
            var marker_image = new daum.maps.MarkerImage(image_src, image_size);

            // 마커 생성
             var marker = new daum.maps.Marker({
                 map: map,
                 position: positions[i].latlng,
                 title: positions[i].title,
                 image: marker_image
             });
        }





   // ------------------------------------------------------------------------------------------


        //위도와 경도
        var latitude;
        var longitude;
        
        
        // 마크가 언제까지 움직일 지 결정하기 위한 변수
        var count = 0;
        
        // 마크를 중지시키기 위한 변수
        var markerInterval;
        
        // 실시간으로 주소를 띄우기 위한 변수
        var address_interval;

        

        // 지도에 클릭 이벤트 등록 및 마지막 파라미터로 넘어온 함수 호출
        daum.maps.event.addListener(map, 'click', function(mouseEvent){
            // 클릭한 위도, 경도 정보 가져오기
            var latlng = mouseEvent.latLng;
            
            // 마커 위치를 클릭한 위치로 이동
            marker.setPosition(latlng);
            
            position_list = [];    

            latitude = latlng.getLat(); //type 은 number
            longitude = latlng.getLng(); 
            position_list.push(latitude);
            position_list.push(longitude);
            
            var check = '위도는' + latitude + ' 경도는' + longitude;
            
            console.log(check); // console 에서 확인
            
            // 마크 움직이기
            // 약 1초당 move_marker_position 함수를 실행
            markerInterval = setInterval(move_marker_position, 500); // 600이 1초인거같음

            address_interval = setInterval(function(){
                
                // position의 type 은 latlng
                // 마크로 찍는 위치의 위치정보를 가지고 와서 이를 주소로 띄워준다.
                var position = new daum.maps.LatLng(latitude, longitude);
               //  마크 위치가 바뀔 때마다 최신화 해서 주소로 띄워주는 함수
               
                searchAddrFromCoords(position,displayCenterInfo); 
            },500 );
        })       
        
        



        // 마커를 이동 시키는 함수
         function move_marker_position() {
            count = count + 1;
            // 위치를 변화시킴 지금은 기울기 1로 움직이지만 도착지점이 정해지면 그에 맞춰서 바꿔주자.
            var now_position = new daum.maps.LatLng(latitude+count*0.00001 , longitude+count*0.00001);
            // 변한 위치에 대하여 marker를 다시 찍어줌
            marker.setPosition(now_position);  
            
            if(count>5) {
                // 5번 이동을 하면 중지시킨다.
                clearInterval(markerInterval);
            }
        }
// ----------------------------------  주소 표시하기  --------------------------------------------
        // 주소-좌표 변환 객체를 생성
        var geocoder = new daum.maps.services.Geocoder();
        
        // 클릭한 위치에 대한 주소를 표시할 인포윈도우
        var infowindow = new daum.maps.InfoWindow({zindex:1});
        
        // 지도 좌측 상단에 주소 표시
        // 첫번째 주소
        searchAddrFromCoords(map.getCenter(),displayCenterInfo); 
    
        
        // 좌표로 행정동 주소 정보를 요청합니다
        function searchAddrFromCoords(coords, callback) {
            geocoder.coord2RegionCode(coords.getLng(), coords.getLat(), callback);       
        }       


        // 지도 좌측상단에 지도 중심좌표에 대한 주소정보를 표출하는 함수입니다
        function displayCenterInfo(result, status) {
            if (status === daum.maps.services.Status.OK) {
            var infoDiv = document.getElementById('address');

            for(var i = 0; i < result.length; i++) {
            // 행정동의 region_type 값은 'H' 이므로
            if (result[i].region_type === 'H') {
                infoDiv.innerHTML = result[i].address_name;
                
                break;
            }
            }
            }  
        }  
// ---------------------------------------------------------------------------------------------
        
	</script>
</body>
</html>


<!-- 

위치 찍었을 때 위치 정보가져오기 - 해결

그 위치를 바탕으로 가장 가까운 위치 가져오기

gps 실시간으로 받아서 지도에 마킹하기 - 해결

-->